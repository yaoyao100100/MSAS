# 心语情感助手 (MSAS - Multimodal Sentiment Analysis System)

一个基于多模态情感分析的智能对话系统，能够通过分析用户的语音、文本内容和面部表情，生成情感适应性回复。

## 功能特点

- **实时对话模式**：通过摄像头和麦克风进行实时情感分析和对话
- **文件分析模式**：上传已有视频文件进行离线分析
- **多模态融合**：结合语音、文本和面部表情进行综合情感判断
- **情感适应性回复**：AI根据用户情感状态调整回复的语气和内容

## 技术架构

- **语音转文本**：基于OpenAI Whisper模型
- **文本情感分析**：使用Erlangshen-Roberta-110M-Sentiment模型
- **面部情绪识别**：使用FER（Facial Emotion Recognition）模型
- **对话生成**：基于Qwen1.5-1.8B-Chat模型
- **前端界面**：使用PyQt5构建的桌面应用

## 安装指南

### 环境要求

- Python 3.13+
- FFmpeg（必需，用于音频处理）
- 摄像头和麦克风（实时对话模式需要）

### FFmpeg安装教程

FFmpeg是处理音频和视频文件的必要工具，本系统需要它来处理音频。

#### Windows系统

1. 访问 [FFmpeg官方下载页](https://www.gyan.dev/ffmpeg/builds/)
2. 下载推荐的版本：

   - 选择 "**ffmpeg-release-essentials.zip**" (Windows 64-bit)
   - 这是一个包含基本组件的稳定版本，约80MB
   - 或者选择 "**ffmpeg-git-full.7z**" 获取完整功能（体积更大，约100MB+）
3. 解压文件：

   - 如果下载了.zip文件，使用Windows自带的解压工具
   - 如果下载了.7z文件，需要使用[7-Zip](https://www.7-zip.org/)解压
   - 建议解压到简单路径，如：`C:\ffmpeg`
4. 添加到系统环境变量Path：

   - 右键点击"此电脑"→"属性"→"高级系统设置"→"环境变量"
   - 在"系统变量"部分，找到"Path"变量并点击"编辑"
   - 点击"新建"，添加FFmpeg的bin目录路径（例如：`C:\ffmpeg\bin`）
   - 依次点击"确定"保存所有更改
5. 验证安装：

   - 重启命令提示符（或PowerShell）
   - 输入命令验证安装：`ffmpeg -version`
   - 应显示类似以下内容：
     ```
     ffmpeg version 4.3.1 Copyright (c) 2000-2020 the FFmpeg developers
     built with gcc 10.2.1 (GCC) 20200726
     ```

### 使用Conda安装MSAS

```bash
# 克隆仓库
git clone https://github.com/yaoyao100100/MSAS.git
cd MSAS

# 创建并激活conda环境
conda env create -f environment.yml
conda activate msas

# 运行程序
python main.py
```

## 使用说明

### 实时对话模式

1. 打开程序，默认进入"实时对话"标签页
2. 等待系统初始化完成（加载AI模型和硬件设备）
3. 点击"开始录制"按钮，对着摄像头和麦克风说话
4. 点击"停止录制"按钮，系统将自动分析并生成回复
5. 可以通过"清空对话"按钮清除对话历史

### 文件分析模式

1. 切换到"文件分析"标签页
2. 点击"上传视频文件"按钮，选择要分析的视频
3. 点击"开始分析"按钮
4. 查看分析结果和AI回复
5. 可以通过"清空结果"按钮清除当前分析结果

## 项目结构

```
MSAS/
├── main.py                 # 程序入口
├── config.py               # 配置文件
├── core/                   # 核心功能模块
│   ├── transcriber.py      # 语音转文本
│   ├── sentiment.py        # 情感分析
│   ├── responder.py        # 大语言模型回复
│   └── analysis_pipeline.py # 分析流程
├── ui/                     # 用户界面
│   ├── main_window.py      # 主窗口
│   ├── camera_tab.py       # 实时对话标签页
│   ├── file_tab.py         # 文件分析标签页
│   └── workers.py          # 后台工作线程
└── utils/                  # 实用工具
    ├── hardware.py         # 硬件接口
    └── cleanup.py          # 清理工具
```

## 注意事项

- 首次运行时，系统会自动下载所需的AI模型，可能需要较长时间
- 请确保系统已安装FFmpeg（用于音频处理）
- 录制的音频和视频文件会保存在`results`目录下
- 大语言模型在低配置设备上可能运行较慢，请耐心等待

## 常见问题

### 无法打开摄像头或麦克风

确保您的设备有可用的摄像头和麦克风，并且已授予程序访问权限。

### 模型加载很慢

首次运行时需下载模型文件，这取决于您的网络速度。后续启动将使用缓存，速度会更快。

### 分析结果不准确

情感分析的准确性受多种因素影响，包括光线条件、录音质量等。请尝试在光线充足的环境中使用，并确保清晰的发音。

### 提示"FFmpeg未找到"错误

如果程序提示找不到FFmpeg，请检查：

1. 是否正确安装了FFmpeg（确认版本：`ffmpeg -version`）
2. FFmpeg的bin目录是否已添加到PATH环境变量
3. 安装后是否重启了命令提示符或PowerShell
4. 如果刚刚添加环境变量，可能需要重启电脑

## 许可证

本项目采用 MIT 许可证，这是一个宽松的许可证，允许您自由地使用、修改、分发和私有化代码，同时保留原作者的版权声明。

### MIT 许可证要点

- ✅ 可以自由使用、复制、修改、合并、发布、分发、再许可及销售本软件
- ✅ 可以用于商业和个人项目
- ✅ 仅需在软件的所有副本中包含原始许可证和版权声明
- ❌ 作者或版权持有人不承担任何因软件产生的责任

完整的许可证文本请参见项目根目录中的 [LICENSE](LICENSE) 文件。
